<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vis-timeline POC - MO/WO Row Packing</title>

    <!-- Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- vis-timeline CSS -->
    <link href="https://unpkg.com/vis-timeline@7.7.3/styles/vis-timeline-graph2d.min.css" rel="stylesheet">

    <!-- Fishbowl Modern Theme (if available) -->
    <link href="fishbowl-theme-modern.css" rel="stylesheet">

    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c5282;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        #visualization {
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 30px;
        }

        .vis-item {
            border-width: 2px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        /* MO styling - thicker bars */
        .vis-item.mo-header {
            background-color: rgba(66, 153, 225, 0.3);
            border-color: #4299e1;
            height: 35px !important;
            line-height: 35px !important;
        }

        /* WO Status colors */
        .vis-item.status-entered {
            background-color: #bee3f8;
            border-color: #4299e1;
        }

        .vis-item.status-started {
            background-color: #fbd38d;
            border-color: #f6ad55;
        }

        .vis-item.status-fulfilled {
            background-color: #9ae6b4;
            border-color: #48bb78;
        }

        .vis-item.conflict {
            background-color: #fc8181 !important;
            border-color: #e53e3e !important;
        }

        .vis-item .vis-item-content {
            padding: 5px;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .vis-item.mo-header .vis-item-content {
            color: #2c5282;
            font-weight: 700;
            text-shadow: none;
        }

        /* Custom time marker for today */
        .vis-custom-time {
            background-color: #e53e3e;
            width: 2px;
        }

        .vis-custom-time .vis-custom-time-marker {
            background-color: #e53e3e;
            color: white;
            padding: 2px 5px;
            font-size: 11px;
            font-weight: 600;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 6px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 30px;
            height: 20px;
            border-radius: 3px;
            border: 2px solid;
        }

        .info-box {
            background: #edf2f7;
            border-left: 4px solid #4299e1;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .info-box h5 {
            color: #2c5282;
            margin-bottom: 10px;
        }

        .info-box ul {
            margin-bottom: 0;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ vis-timeline Proof of Concept</h1>
        <p class="subtitle">Testing automatic row packing for MO/WO scheduling</p>

        <div class="info-box">
            <h5>‚ú® Key Features Being Demonstrated:</h5>
            <ul>
                <li><strong>Automatic Row Packing:</strong> MOs share rows when they don't overlap</li>
                <li><strong>Group Stacking:</strong> WOs within each MO stack automatically</li>
                <li><strong>Today Marker:</strong> Red line shows current date</li>
                <li><strong>Scroll to Today:</strong> Chart centers on today's date</li>
                <li><strong>Status Colors:</strong> Blue (Entered), Orange (Started), Green (Fulfilled), Red (Conflict)</li>
                <li><strong>Interactive:</strong> Click items to see details, drag to move (disabled in POC)</li>
            </ul>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: rgba(66, 153, 225, 0.3); border-color: #4299e1;"></div>
                <span><strong>MO Headers</strong></span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #bee3f8; border-color: #4299e1;"></div>
                <span>Entered (WO)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #fbd38d; border-color: #f6ad55;"></div>
                <span>Started (WO)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #9ae6b4; border-color: #48bb78;"></div>
                <span>Fulfilled (WO)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #fc8181; border-color: #e53e3e;"></div>
                <span>Conflict (WO)</span>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="scrollToToday()">
                üìÖ Scroll to Today
            </button>
            <button class="btn btn-outline-secondary" onclick="zoomIn()">
                üîç Zoom In
            </button>
            <button class="btn btn-outline-secondary" onclick="zoomOut()">
                üîç Zoom Out
            </button>
            <button class="btn btn-outline-secondary" onclick="fitAll()">
                üìè Fit All
            </button>
        </div>

        <div id="visualization"></div>

        <div class="alert alert-info">
            <strong>üí° Notice:</strong> Multiple MOs are sharing the same rows because they don't overlap in time!
            This is the automatic row-packing feature that Frappe Gantt doesn't have.
        </div>
    </div>

    <!-- vis-timeline JS -->
    <script src="https://unpkg.com/vis-timeline@7.7.3/standalone/umd/vis-timeline-graph2d.min.js"></script>

    <!-- Moment.js for date handling -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

    <script>
        // Sample data simulating your Fishbowl MOs and WOs
        const sampleData = {
            mos: [
                { mo_num: '112', mo_id: 1, status: 'started' },
                { mo_num: '113', mo_id: 2, status: 'entered' },
                { mo_num: '114', mo_id: 3, status: 'fulfilled' },
                { mo_num: '115', mo_id: 4, status: 'entered' },
                { mo_num: '116', mo_id: 5, status: 'started' }
            ],
            wos: [
                // MO 112 WOs
                { wo_num: '100', mo_num: '112', status: 'started', start: '2025-12-10', end: '2025-12-12', part_num: 'PART-A', qty: 50 },
                { wo_num: '101', mo_num: '112', status: 'started', start: '2025-12-13', end: '2025-12-15', part_num: 'PART-B', qty: 30 },
                { wo_num: '102', mo_num: '112', status: 'entered', start: '2025-12-16', end: '2025-12-18', part_num: 'PART-C', qty: 20 },

                // MO 113 WOs (doesn't overlap with 112, should share row)
                { wo_num: '103', mo_num: '113', status: 'entered', start: '2025-12-20', end: '2025-12-22', part_num: 'PART-D', qty: 100 },
                { wo_num: '104', mo_num: '113', status: 'entered', start: '2025-12-23', end: '2025-12-25', part_num: 'PART-E', qty: 75 },

                // MO 114 WOs (overlaps with 112, needs separate row)
                { wo_num: '105', mo_num: '114', status: 'fulfilled', start: '2025-12-11', end: '2025-12-13', part_num: 'PART-F', qty: 60 },
                { wo_num: '106', mo_num: '114', status: 'fulfilled', start: '2025-12-14', end: '2025-12-16', part_num: 'PART-G', qty: 40 },

                // MO 115 WOs (future dates, should share row with 113)
                { wo_num: '107', mo_num: '115', status: 'entered', start: '2025-12-26', end: '2025-12-28', part_num: 'PART-H', qty: 90 },
                { wo_num: '108', mo_num: '115', status: 'entered', start: '2025-12-29', end: '2025-12-31', part_num: 'PART-I', qty: 55, conflict: true },

                // MO 116 WOs (overlaps with 114)
                { wo_num: '109', mo_num: '116', status: 'started', start: '2025-12-12', end: '2025-12-14', part_num: 'PART-J', qty: 80 },
                { wo_num: '110', mo_num: '116', status: 'entered', start: '2025-12-15', end: '2025-12-17', part_num: 'PART-K', qty: 45 }
            ]
        };

        // Convert to vis-timeline format
        function prepareTimelineData() {
            const groups = [];
            const items = [];

            // Create groups for each MO (with nestedGroups for stacking)
            sampleData.mos.forEach(mo => {
                groups.push({
                    id: `mo_${mo.mo_id}`,
                    content: `<strong>MO ${mo.mo_num}</strong>`,
                    nestedGroups: [`mo_${mo.mo_id}_wos`]
                });

                // Nested group for WOs within this MO
                groups.push({
                    id: `mo_${mo.mo_id}_wos`,
                    content: `  ‚Ü≥ WOs`
                });
            });

            // Add MO header items (spans all WOs in that MO)
            sampleData.mos.forEach(mo => {
                const moWos = sampleData.wos.filter(wo => wo.mo_num === mo.mo_num);
                if (moWos.length === 0) return;

                const startDates = moWos.map(wo => moment(wo.start));
                const endDates = moWos.map(wo => moment(wo.end));
                const minDate = moment.min(startDates);
                const maxDate = moment.max(endDates);

                items.push({
                    id: `mo_header_${mo.mo_id}`,
                    group: `mo_${mo.mo_id}`,
                    content: `MO ${mo.mo_num}`,
                    start: minDate.toDate(),
                    end: maxDate.toDate(),
                    className: 'mo-header',
                    type: 'range'
                });
            });

            // Add WO items
            sampleData.wos.forEach((wo, index) => {
                const mo = sampleData.mos.find(m => m.mo_num === wo.mo_num);
                const statusClass = `status-${wo.status}`;
                const conflictClass = wo.conflict ? ' conflict' : '';

                items.push({
                    id: `wo_${index}`,
                    group: `mo_${mo.mo_id}_wos`,
                    content: `${wo.wo_num} - ${wo.part_num} (${wo.qty})`,
                    start: moment(wo.start).toDate(),
                    end: moment(wo.end).toDate(),
                    className: statusClass + conflictClass,
                    type: 'range',
                    title: `WO: ${wo.wo_num}<br>MO: ${wo.mo_num}<br>Part: ${wo.part_num}<br>Qty: ${wo.qty}<br>Status: ${wo.status}<br>Start: ${wo.start}<br>End: ${wo.end}`
                });
            });

            return { groups, items };
        }

        // Initialize timeline
        const container = document.getElementById('visualization');
        const { groups, items } = prepareTimelineData();

        const options = {
            // Row stacking configuration - THIS IS THE KEY FEATURE!
            stack: true,  // Enable automatic stacking
            stackSubgroups: true,  // Stack items within nested groups

            // Orientation
            orientation: 'top',

            // Zoom and move
            zoomable: true,
            moveable: true,

            // Time axis
            showCurrentTime: false,  // We'll use custom time instead

            // Interaction
            editable: false,  // Disable dragging in POC

            // Styling
            margin: {
                item: {
                    horizontal: 2,
                    vertical: 5
                }
            },

            // Time range
            start: moment().subtract(7, 'days').toDate(),
            end: moment().add(21, 'days').toDate(),

            // Group styling
            groupHeightMode: 'fixed'
        };

        const timeline = new vis.Timeline(container, items, groups, options);

        // Add today marker
        timeline.addCustomTime(new Date(), 'today');
        timeline.setCustomTimeMarker('TODAY', 'today', false);
        timeline.setCustomTimeTitle('Today', 'today');

        // Scroll to today on load
        setTimeout(() => {
            scrollToToday();
        }, 500);

        // Helper functions
        function scrollToToday() {
            timeline.moveTo(new Date(), {
                animation: {
                    duration: 500,
                    easingFunction: 'easeInOutQuad'
                }
            });
        }

        function zoomIn() {
            timeline.zoomIn(0.5);
        }

        function zoomOut() {
            timeline.zoomOut(0.5);
        }

        function fitAll() {
            timeline.fit({
                animation: {
                    duration: 500,
                    easingFunction: 'easeInOutQuad'
                }
            });
        }

        // Log when items are clicked
        timeline.on('select', function(properties) {
            if (properties.items.length > 0) {
                const itemId = properties.items[0];
                const item = items.find(i => i.id === itemId);
                console.log('Selected item:', item);
            }
        });

        console.log('‚úÖ vis-timeline POC loaded successfully!');
        console.log('üìä Groups:', groups);
        console.log('üì¶ Items:', items);
        console.log('‚öôÔ∏è Options:', options);
    </script>
</body>
</html>
