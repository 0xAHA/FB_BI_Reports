<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vis-timeline Toggle POC - MO Gantt vs Category Swim Lanes</title>

    <!-- vis-timeline CSS -->
    <link href="https://unpkg.com/vis-timeline@7.7.3/styles/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />

    <!-- Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            padding: 20px;
            background-color: #f8f9fa;
        }

        #visualization {
            height: 600px;
            border: 1px solid #ddd;
            background-color: white;
            border-radius: 4px;
        }

        /* Status colors matching Fishbowl report */
        .status-entered {
            background-color: #3498db !important;
            border-color: #2980b9 !important;
        }

        .status-started {
            background-color: #f39c12 !important;
            border-color: #e67e22 !important;
        }

        .status-fulfilled {
            background-color: #27ae60 !important;
            border-color: #229954 !important;
        }

        .status-conflict {
            background-color: #e74c3c !important;
            border-color: #c0392b !important;
            box-shadow: 0 0 8px rgba(231, 76, 60, 0.5) !important;
        }

        /* MO header styling */
        .mo-header {
            background-color: #34495e !important;
            border-color: #2c3e50 !important;
            font-weight: bold;
            color: white !important;
        }

        /* Group labels */
        .vis-label {
            font-weight: 500;
        }

        .vis-label .badge {
            margin-left: 8px;
            font-size: 0.75em;
        }

        /* Today marker */
        .vis-custom-time {
            background-color: #e74c3c;
            width: 2px;
        }

        .view-toggle-btn {
            padding: 8px 16px;
            border: 2px solid #3498db;
            background-color: white;
            color: #3498db;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .view-toggle-btn:hover {
            background-color: #ebf5fb;
        }

        .view-toggle-btn.active {
            background-color: #3498db;
            color: white;
        }

        .info-card {
            background-color: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .legend-item {
            display: inline-flex;
            align-items: center;
            margin-right: 20px;
            margin-bottom: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 8px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row mb-3">
            <div class="col">
                <h2>
                    <i class="bi bi-diagram-3"></i>
                    vis-timeline Toggle POC
                </h2>
                <p class="text-muted">Demonstrating MO Gantt View vs Category Swim Lane View</p>
            </div>
        </div>

        <!-- View Toggle Controls -->
        <div class="info-card">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h5 class="mb-3">View Mode</h5>
                    <div class="btn-group" role="group">
                        <button id="moViewBtn" class="view-toggle-btn active">
                            <i class="bi bi-list-nested"></i> MO Gantt View
                        </button>
                        <button id="categoryViewBtn" class="view-toggle-btn">
                            <i class="bi bi-layout-three-columns"></i> Category Swim Lane View
                        </button>
                    </div>
                    <div class="mt-3">
                        <small id="viewDescription" class="text-muted">
                            <strong>MO Gantt View:</strong> Groups Work Orders by Manufacturing Order. Best for tracking individual order progress.
                        </small>
                    </div>
                </div>
                <div class="col-md-6">
                    <h5 class="mb-3">Timeline Controls</h5>
                    <div class="btn-group btn-group-sm" role="group">
                        <button id="zoomInBtn" class="btn btn-outline-secondary">
                            <i class="bi bi-zoom-in"></i> Zoom In
                        </button>
                        <button id="zoomOutBtn" class="btn btn-outline-secondary">
                            <i class="bi bi-zoom-out"></i> Zoom Out
                        </button>
                        <button id="fitBtn" class="btn btn-outline-secondary">
                            <i class="bi bi-arrows-angle-contract"></i> Fit All
                        </button>
                        <button id="todayBtn" class="btn btn-outline-primary">
                            <i class="bi bi-calendar-day"></i> Today
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Legend -->
        <div class="info-card">
            <h6>Status Legend</h6>
            <div class="legend-item">
                <div class="legend-color status-entered"></div>
                <span>Entered (10)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color status-started"></div>
                <span>Started (30)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color status-fulfilled"></div>
                <span>Fulfilled (40)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color status-conflict"></div>
                <span>Dependency Conflict</span>
            </div>
            <div class="legend-item">
                <div class="legend-color mo-header"></div>
                <span>MO Header</span>
            </div>
        </div>

        <!-- Timeline Container -->
        <div id="visualization"></div>

        <!-- Info Panel -->
        <div class="info-card mt-3">
            <h6>Sample Data Info</h6>
            <p class="mb-2"><strong>5 Manufacturing Orders</strong> with <strong>11 Work Orders</strong></p>
            <p class="mb-2"><strong>3 Categories:</strong> Fabrication, Powdercoating, Assembly</p>
            <p class="mb-0">
                <i class="bi bi-info-circle"></i>
                <small>Toggle between views to see how the same data is organized differently. Category view shows capacity utilization per category.</small>
            </p>
        </div>
    </div>

    <!-- vis-timeline JS -->
    <script src="https://unpkg.com/vis-timeline@7.7.3/standalone/umd/vis-timeline-graph2d.min.js"></script>

    <script>
        // ============================================
        // Sample Data
        // ============================================
        const sampleData = {
            mos: [
                { mo_id: 112, mo_num: '112', mo_status: 'Started' },
                { mo_id: 113, mo_num: '113', mo_status: 'Entered' },
                { mo_id: 114, mo_num: '114', mo_status: 'Started' },
                { mo_id: 115, mo_num: '115', mo_status: 'Entered' },
                { mo_id: 116, mo_num: '116', mo_status: 'Fulfilled' }
            ],
            wos: [
                // MO 112 - overlaps with 113/115
                { wo_id: 101, wo_num: '1001', mo_id: 112, mo_num: '112', category: 'Fabrication', status: 30, start: '2025-12-16', end: '2025-12-18', part: 'PART-101', qty: 10 },
                { wo_id: 102, wo_num: '1002', mo_id: 112, mo_num: '112', category: 'Powdercoating', status: 30, start: '2025-12-19', end: '2025-12-20', part: 'PART-102', qty: 10, deps: [101] },
                { wo_id: 103, wo_num: '1003', mo_id: 112, mo_num: '112', category: 'Assembly', status: 10, start: '2025-12-21', end: '2025-12-22', part: 'PART-103', qty: 10, deps: [102] },

                // MO 113 - overlaps with 112
                { wo_id: 201, wo_num: '2001', mo_id: 113, mo_num: '113', category: 'Fabrication', status: 10, start: '2025-12-17', end: '2025-12-19', part: 'PART-201', qty: 5 },
                { wo_id: 202, wo_num: '2002', mo_id: 113, mo_num: '113', category: 'Assembly', status: 10, start: '2025-12-20', end: '2025-12-21', part: 'PART-202', qty: 5, deps: [201] },

                // MO 114 - separate timeline
                { wo_id: 301, wo_num: '3001', mo_id: 114, mo_num: '114', category: 'Fabrication', status: 30, start: '2025-12-23', end: '2025-12-25', part: 'PART-301', qty: 8 },
                { wo_id: 302, wo_num: '3002', mo_id: 114, mo_num: '114', category: 'Powdercoating', status: 10, start: '2025-12-26', end: '2025-12-27', part: 'PART-302', qty: 8, deps: [301] },

                // MO 115 - overlaps with 112
                { wo_id: 401, wo_num: '4001', mo_id: 115, mo_num: '115', category: 'Fabrication', status: 10, start: '2025-12-16', end: '2025-12-17', part: 'PART-401', qty: 15 },
                { wo_id: 402, wo_num: '4002', mo_id: 115, mo_num: '115', category: 'Assembly', status: 10, start: '2025-12-18', end: '2025-12-19', part: 'PART-402', qty: 15, deps: [401] },

                // MO 116 - fulfilled, separate timeline
                { wo_id: 501, wo_num: '5001', mo_id: 116, mo_num: '116', category: 'Fabrication', status: 40, start: '2025-12-12', end: '2025-12-13', part: 'PART-501', qty: 20 },
                { wo_id: 502, wo_num: '5002', mo_id: 116, mo_num: '116', category: 'Powdercoating', status: 40, start: '2025-12-14', end: '2025-12-15', part: 'PART-502', qty: 20, deps: [501] }
            ]
        };

        // ============================================
        // State Management
        // ============================================
        let viewMode = 'mo'; // 'mo' or 'category'
        let timeline;
        let groups;
        let items;

        // ============================================
        // Helper Functions
        // ============================================

        function getStatusClass(wo) {
            if (wo.status === 10) return 'status-entered';
            if (wo.status === 30) return 'status-started';
            if (wo.status === 40) return 'status-fulfilled';
            return '';
        }

        function getMOStatusClass(moNum) {
            const wos = sampleData.wos.filter(wo => wo.mo_num === moNum);
            const statuses = wos.map(wo => wo.status);

            if (statuses.includes(30)) return 'status-started';
            if (statuses.every(s => s === 40)) return 'status-fulfilled';
            if (statuses.every(s => s === 10)) return 'status-entered';
            return '';
        }

        // ============================================
        // Build Groups Based on View Mode
        // ============================================

        function buildMOGroups() {
            const moGroups = [];

            sampleData.mos.forEach(mo => {
                // MO header
                moGroups.push({
                    id: `mo_${mo.mo_id}`,
                    content: `<strong>MO ${mo.mo_num}</strong>`,
                    nestedGroups: [`mo_${mo.mo_id}_wos`]
                });

                // Nested group for WOs
                moGroups.push({
                    id: `mo_${mo.mo_id}_wos`,
                    content: `  â†³ Work Orders`
                });
            });

            return moGroups;
        }

        function buildCategoryGroups() {
            // Get unique categories and count WOs in each
            const categoryMap = {};
            sampleData.wos.forEach(wo => {
                if (!categoryMap[wo.category]) {
                    categoryMap[wo.category] = {
                        count: 0,
                        wos: []
                    };
                }
                categoryMap[wo.category].count++;
                categoryMap[wo.category].wos.push(wo);
            });

            // Build groups
            const catGroups = [];
            Object.keys(categoryMap).sort().forEach(category => {
                const info = categoryMap[category];
                catGroups.push({
                    id: `cat_${category}`,
                    content: `<strong>${category}</strong> <span class="badge bg-secondary">${info.count} WOs</span>`
                });
            });

            return catGroups;
        }

        // ============================================
        // Build Items Based on View Mode
        // ============================================

        function buildItems() {
            const timelineItems = [];

            if (viewMode === 'mo') {
                // Add MO headers as items
                sampleData.mos.forEach(mo => {
                    const wos = sampleData.wos.filter(wo => wo.mo_id === mo.mo_id);
                    if (wos.length === 0) return;

                    const starts = wos.map(wo => new Date(wo.start));
                    const ends = wos.map(wo => new Date(wo.end));
                    const moStart = new Date(Math.min(...starts));
                    const moEnd = new Date(Math.max(...ends));

                    timelineItems.push({
                        id: `mo_header_${mo.mo_id}`,
                        group: `mo_${mo.mo_id}`,
                        content: `MO ${mo.mo_num}`,
                        start: moStart,
                        end: moEnd,
                        type: 'range',
                        className: `mo-header ${getMOStatusClass(mo.mo_num)}`,
                        title: `Manufacturing Order ${mo.mo_num}\nStatus: ${mo.mo_status}`
                    });
                });

                // Add WOs under their MO
                sampleData.wos.forEach(wo => {
                    timelineItems.push({
                        id: `wo_${wo.wo_id}`,
                        group: `mo_${wo.mo_id}_wos`,
                        content: `WO ${wo.wo_num}`,
                        start: wo.start,
                        end: wo.end,
                        type: 'range',
                        className: getStatusClass(wo),
                        title: `WO ${wo.wo_num}\nMO ${wo.mo_num}\nCategory: ${wo.category}\nPart: ${wo.part} (${wo.qty})\nStatus: ${wo.status === 10 ? 'Entered' : wo.status === 30 ? 'Started' : 'Fulfilled'}`,
                        woData: wo
                    });
                });

            } else {
                // Category view - all WOs grouped by category
                sampleData.wos.forEach(wo => {
                    timelineItems.push({
                        id: `wo_${wo.wo_id}`,
                        group: `cat_${wo.category}`,
                        content: `WO ${wo.wo_num} (MO ${wo.mo_num})`,
                        start: wo.start,
                        end: wo.end,
                        type: 'range',
                        className: getStatusClass(wo),
                        title: `WO ${wo.wo_num}\nMO ${wo.mo_num}\nCategory: ${wo.category}\nPart: ${wo.part} (${wo.qty})\nStatus: ${wo.status === 10 ? 'Entered' : wo.status === 30 ? 'Started' : 'Fulfilled'}`,
                        woData: wo
                    });
                });
            }

            return timelineItems;
        }

        // ============================================
        // Switch View Mode
        // ============================================

        function switchView(newMode) {
            if (newMode === viewMode) return;

            viewMode = newMode;

            // Update button states
            document.getElementById('moViewBtn').classList.toggle('active', viewMode === 'mo');
            document.getElementById('categoryViewBtn').classList.toggle('active', viewMode === 'category');

            // Update description
            const description = viewMode === 'mo'
                ? '<strong>MO Gantt View:</strong> Groups Work Orders by Manufacturing Order. Best for tracking individual order progress.'
                : '<strong>Category Swim Lane View:</strong> Groups Work Orders by Category. Best for capacity planning and resource utilization.';
            document.getElementById('viewDescription').innerHTML = description;

            // Rebuild groups and items
            groups = viewMode === 'mo' ? buildMOGroups() : buildCategoryGroups();
            items = buildItems();

            // Update timeline
            timeline.setGroups(groups);
            timeline.setItems(items);

            console.log(`Switched to ${viewMode} view`);
        }

        // ============================================
        // Initialize Timeline
        // ============================================

        function initTimeline() {
            const container = document.getElementById('visualization');

            // Initial groups and items
            groups = buildMOGroups();
            items = buildItems();

            // Timeline options
            const options = {
                // Row stacking configuration
                stack: true,
                stackSubgroups: true,

                // Orientation
                orientation: 'top',

                // Zoom and move
                zoomable: true,
                moveable: true,

                // Interaction
                editable: false,

                // Time axis
                format: {
                    minorLabels: {
                        day: 'D',
                        weekday: 'ddd D'
                    },
                    majorLabels: {
                        day: 'MMMM YYYY',
                        weekday: 'MMMM YYYY'
                    }
                },

                // Margins
                margin: {
                    item: {
                        horizontal: 10,
                        vertical: 5
                    }
                },

                // Start/end dates
                start: '2025-12-10',
                end: '2025-12-30'
            };

            // Create timeline
            timeline = new vis.Timeline(container, items, groups, options);

            // Add today marker
            timeline.addCustomTime(new Date(), 'today');
            timeline.setCustomTimeMarker('Today', 'today', false);

            console.log('Timeline initialized in MO view');
        }

        // ============================================
        // Event Listeners
        // ============================================

        document.getElementById('moViewBtn').addEventListener('click', () => switchView('mo'));
        document.getElementById('categoryViewBtn').addEventListener('click', () => switchView('category'));

        document.getElementById('zoomInBtn').addEventListener('click', () => {
            timeline.zoomIn(0.2);
        });

        document.getElementById('zoomOutBtn').addEventListener('click', () => {
            timeline.zoomOut(0.2);
        });

        document.getElementById('fitBtn').addEventListener('click', () => {
            timeline.fit();
        });

        document.getElementById('todayBtn').addEventListener('click', () => {
            timeline.moveTo(new Date());
        });

        // ============================================
        // Initialize on Load
        // ============================================

        document.addEventListener('DOMContentLoaded', () => {
            initTimeline();
        });
    </script>
</body>
</html>
