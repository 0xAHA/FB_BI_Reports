<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Library Comparison — Sales &amp; Margin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- D3.js v7 (current) -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

    <style>
        * { font-family: 'Inter', sans-serif; }

        .chart-section {
            background: white;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            border: 1px solid #e2e8f0;
            padding: 24px;
            margin-bottom: 24px;
        }
        .chart-section h2 {
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }
        .chart-section .subtitle {
            font-size: 13px;
            color: #64748b;
            margin-bottom: 16px;
        }
        .chart-container {
            width: 100%;
            height: 320px;
            position: relative;
        }

        /* D3 chart styles (matching Sales_Dashboard.htm) */
        .d3-chart .axis line, .d3-chart .axis path { stroke: #cbd5e1; shape-rendering: crispEdges; }
        .d3-chart .axis text { fill: #64748b; font-size: 11px; font-weight: 500; }
        .d3-chart .grid line { stroke: #e2e8f0; stroke-opacity: 0.7; }

        /* Shared tooltip for D3 */
        #d3-tooltip {
            position: absolute;
            background: rgba(15, 23, 42, 0.95);
            color: white;
            padding: 10px 14px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s;
            z-index: 100;
            line-height: 1.6;
        }
        #d3-tooltip .tooltip-label { color: #94a3b8; margin-right: 6px; }
        #d3-tooltip .tooltip-value { color: white; font-weight: 600; }

        .badge {
            display: inline-block;
            padding: 2px 10px;
            border-radius: 9999px;
            font-size: 11px;
            font-weight: 600;
        }

        .pros-cons { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; }
        .pros-cons ul { list-style: none; padding: 0; margin: 0; }
        .pros-cons li { font-size: 12px; color: #475569; padding: 3px 0; }
        .pros-cons li::before { margin-right: 6px; font-weight: bold; }
        .pros li::before { content: '+'; color: #10b981; }
        .cons li::before { content: '−'; color: #ef4444; }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 8px;
            margin-bottom: 12px;
        }
        .info-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 8px 12px;
            text-align: center;
        }
        .info-item .label { font-size: 10px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; }
        .info-item .value { font-size: 13px; color: #1e293b; font-weight: 600; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">

<div id="d3-tooltip"></div>

<div class="max-w-6xl mx-auto px-6 py-8">

    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-2xl font-bold text-slate-900">Chart Library Comparison</h1>
        <p class="text-sm text-slate-500 mt-1">Same dummy sales &amp; margin data rendered with four different libraries</p>
        <div class="flex gap-4 mt-4">
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full" style="background: #2d9cdb;"></div>
                <span class="text-xs text-slate-600 font-medium">Revenue (left axis)</span>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full" style="background: #f59e0b;"></div>
                <span class="text-xs text-slate-600 font-medium">Margin % (right axis)</span>
            </div>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════════ -->
    <!-- 1. D3.js (Current) -->
    <!-- ═══════════════════════════════════════════════════════════════════ -->
    <div class="chart-section">
        <div class="flex items-center gap-3 mb-1">
            <h2>1. D3.js v7</h2>
            <span class="badge bg-blue-100 text-blue-700">Current</span>
        </div>
        <p class="subtitle">Raw SVG construction — what we use today in Sales_Dashboard.htm</p>
        <div class="info-grid">
            <div class="info-item"><div class="label">Size (min+gz)</div><div class="value">~80 KB</div></div>
            <div class="info-item"><div class="label">Rendering</div><div class="value">SVG</div></div>
            <div class="info-item"><div class="label">Framework</div><div class="value">None needed</div></div>
        </div>
        <div class="chart-container d3-chart" id="d3Chart"></div>
        <div class="pros-cons">
            <ul class="pros">
                <li>Total control over every pixel</li>
                <li>No abstraction layer — direct SVG manipulation</li>
                <li>Flexible for custom visualisations (donuts, sankeys, etc.)</li>
                <li>Already integrated in our codebase</li>
            </ul>
            <ul class="cons">
                <li>Verbose — our renderRevenueChart is ~430 lines</li>
                <li>Must manually build axes, grids, tooltips, legends</li>
                <li>Responsive resize requires manual handling</li>
                <li>Steep learning curve for maintenance</li>
            </ul>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════════ -->
    <!-- 2. ApexCharts -->
    <!-- ═══════════════════════════════════════════════════════════════════ -->
    <div class="chart-section">
        <div class="flex items-center gap-3 mb-1">
            <h2>2. ApexCharts</h2>
            <span class="badge bg-emerald-100 text-emerald-700">Recommended</span>
        </div>
        <p class="subtitle">Declarative config-driven charting — closest to Recharts without needing React</p>
        <div class="info-grid">
            <div class="info-item"><div class="label">Size (min+gz)</div><div class="value">~130 KB</div></div>
            <div class="info-item"><div class="label">Rendering</div><div class="value">SVG</div></div>
            <div class="info-item"><div class="label">Framework</div><div class="value">None needed</div></div>
        </div>
        <div class="chart-container" id="apexChart"></div>
        <div class="pros-cons">
            <ul class="pros">
                <li>Declarative JSON config — ~60 lines vs 430</li>
                <li>Built-in tooltips, zoom, pan, export</li>
                <li>Auto-responsive, no manual resize code</li>
                <li>Dual Y-axis is a first-class feature</li>
            </ul>
            <ul class="cons">
                <li>Less fine-grained control than raw D3</li>
                <li>Larger bundle than D3 alone</li>
                <li>Custom chart types (sankey, etc.) not supported</li>
                <li>New dependency to learn and maintain</li>
            </ul>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════════ -->
    <!-- 3. Chart.js -->
    <!-- ═══════════════════════════════════════════════════════════════════ -->
    <div class="chart-section">
        <div class="flex items-center gap-3 mb-1">
            <h2>3. Chart.js v4</h2>
            <span class="badge bg-slate-100 text-slate-700">Popular</span>
        </div>
        <p class="subtitle">Canvas-based, lightweight, huge community — the most popular charting library</p>
        <div class="info-grid">
            <div class="info-item"><div class="label">Size (min+gz)</div><div class="value">~65 KB</div></div>
            <div class="info-item"><div class="label">Rendering</div><div class="value">Canvas</div></div>
            <div class="info-item"><div class="label">Framework</div><div class="value">None needed</div></div>
        </div>
        <div class="chart-container">
            <canvas id="chartjsChart"></canvas>
        </div>
        <div class="pros-cons">
            <ul class="pros">
                <li>Smallest bundle size of the three alternatives</li>
                <li>Canvas renders large datasets faster than SVG</li>
                <li>Massive ecosystem — plugins for everything</li>
                <li>Simple API, easy to learn</li>
            </ul>
            <ul class="cons">
                <li>Canvas — no DOM elements to style or inspect</li>
                <li>Tooltips and interactions less customisable</li>
                <li>Mixed chart types (bar + line) need care</li>
                <li>No SVG export (print quality is pixel-based)</li>
            </ul>
        </div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════════ -->
    <!-- 4. ECharts -->
    <!-- ═══════════════════════════════════════════════════════════════════ -->
    <div class="chart-section">
        <div class="flex items-center gap-3 mb-1">
            <h2>4. Apache ECharts v5</h2>
            <span class="badge bg-purple-100 text-purple-700">Feature-rich</span>
        </div>
        <p class="subtitle">Full-featured charting from Apache — supports SVG and Canvas, massive chart type library</p>
        <div class="info-grid">
            <div class="info-item"><div class="label">Size (min+gz)</div><div class="value">~350 KB</div></div>
            <div class="info-item"><div class="label">Rendering</div><div class="value">SVG or Canvas</div></div>
            <div class="info-item"><div class="label">Framework</div><div class="value">None needed</div></div>
        </div>
        <div class="chart-container" id="echartsChart"></div>
        <div class="pros-cons">
            <ul class="pros">
                <li>Richest feature set — 20+ chart types built-in</li>
                <li>SVG or Canvas rendering (switchable)</li>
                <li>Built-in animations, data zoom, toolbox</li>
                <li>Excellent for complex dashboards</li>
            </ul>
            <ul class="cons">
                <li>Heaviest bundle by far (~350 KB gz)</li>
                <li>Configuration can become deeply nested</li>
                <li>Overkill if we only need line/bar/donut</li>
                <li>Documentation primarily CJK-oriented</li>
            </ul>
        </div>
    </div>

    <!-- Summary -->
    <div class="chart-section" style="border: 2px solid #2d9cdb;">
        <h2 class="mb-3">Summary Comparison</h2>
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead>
                    <tr class="border-b border-slate-200">
                        <th class="text-left py-2 text-slate-500 font-medium"></th>
                        <th class="text-center py-2 text-slate-500 font-medium">D3.js (Current)</th>
                        <th class="text-center py-2 text-slate-500 font-medium">ApexCharts</th>
                        <th class="text-center py-2 text-slate-500 font-medium">Chart.js</th>
                        <th class="text-center py-2 text-slate-500 font-medium">ECharts</th>
                    </tr>
                </thead>
                <tbody class="text-slate-700">
                    <tr class="border-b border-slate-100">
                        <td class="py-2 font-medium">Bundle size</td>
                        <td class="text-center">~80 KB</td>
                        <td class="text-center">~130 KB</td>
                        <td class="text-center text-emerald-600 font-semibold">~65 KB</td>
                        <td class="text-center text-red-500">~350 KB</td>
                    </tr>
                    <tr class="border-b border-slate-100">
                        <td class="py-2 font-medium">Code to produce this chart</td>
                        <td class="text-center text-red-500">~120 lines</td>
                        <td class="text-center text-emerald-600 font-semibold">~70 lines</td>
                        <td class="text-center text-emerald-600 font-semibold">~75 lines</td>
                        <td class="text-center">~85 lines</td>
                    </tr>
                    <tr class="border-b border-slate-100">
                        <td class="py-2 font-medium">Dual Y-axis</td>
                        <td class="text-center">Manual</td>
                        <td class="text-center text-emerald-600 font-semibold">Built-in</td>
                        <td class="text-center text-emerald-600 font-semibold">Built-in</td>
                        <td class="text-center text-emerald-600 font-semibold">Built-in</td>
                    </tr>
                    <tr class="border-b border-slate-100">
                        <td class="py-2 font-medium">Responsive</td>
                        <td class="text-center">Manual</td>
                        <td class="text-center text-emerald-600 font-semibold">Auto</td>
                        <td class="text-center text-emerald-600 font-semibold">Auto</td>
                        <td class="text-center text-emerald-600 font-semibold">Auto</td>
                    </tr>
                    <tr class="border-b border-slate-100">
                        <td class="py-2 font-medium">Tooltips</td>
                        <td class="text-center">Manual HTML</td>
                        <td class="text-center text-emerald-600 font-semibold">Built-in</td>
                        <td class="text-center text-emerald-600 font-semibold">Built-in</td>
                        <td class="text-center text-emerald-600 font-semibold">Built-in</td>
                    </tr>
                    <tr class="border-b border-slate-100">
                        <td class="py-2 font-medium">Rendering</td>
                        <td class="text-center">SVG</td>
                        <td class="text-center">SVG</td>
                        <td class="text-center">Canvas</td>
                        <td class="text-center">Both</td>
                    </tr>
                    <tr class="border-b border-slate-100">
                        <td class="py-2 font-medium">Custom chart types</td>
                        <td class="text-center text-emerald-600 font-semibold">Unlimited</td>
                        <td class="text-center">Limited</td>
                        <td class="text-center">Via plugins</td>
                        <td class="text-center text-emerald-600 font-semibold">Extensive</td>
                    </tr>
                    <tr>
                        <td class="py-2 font-medium">Fits our architecture</td>
                        <td class="text-center text-emerald-600 font-semibold">Yes (in use)</td>
                        <td class="text-center text-emerald-600 font-semibold">Yes</td>
                        <td class="text-center text-emerald-600 font-semibold">Yes</td>
                        <td class="text-center text-emerald-600 font-semibold">Yes</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>

<script>
// ═══════════════════════════════════════════════════════════════════════════════
// SHARED TEST DATA
// ═══════════════════════════════════════════════════════════════════════════════
const months = [
    '2025-07', '2025-08', '2025-09', '2025-10', '2025-11', '2025-12',
    '2026-01', '2026-02'
];
const monthLabels = ['Jul 25', 'Aug 25', 'Sep 25', 'Oct 25', 'Nov 25', 'Dec 25', 'Jan 26', 'Feb 26'];
const revenue     = [42500, 38900, 51200, 47800, 55600, 62300, 58100, 44700];
const marginPct   = [32.5,  28.1,  35.8,  31.2,  38.4,  41.2,  36.9,  29.5];

const BLUE  = '#2d9cdb';
const AMBER = '#f59e0b';


// ═══════════════════════════════════════════════════════════════════════════════
// 1. D3.js — Matching our current Sales_Dashboard.htm pattern
// ═══════════════════════════════════════════════════════════════════════════════
(function renderD3Chart() {
    const container = document.getElementById('d3Chart');
    const tooltip   = d3.select('#d3-tooltip');

    const margin = { top: 20, right: 80, bottom: 40, left: 80 };
    const width  = container.offsetWidth - margin.left - margin.right;
    const height = 280 - margin.top - margin.bottom;

    const svg = d3.select(container)
        .append('svg')
        .attr('width',  width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom)
        .append('g')
        .attr('transform', `translate(${margin.left},${margin.top})`);

    // Scales
    const x = d3.scaleBand()
        .domain(months)
        .range([0, width])
        .padding(0.3);

    const yRevenue = d3.scaleLinear()
        .domain([0, d3.max(revenue)])
        .nice()
        .range([height, 0]);

    const yMargin = d3.scaleLinear()
        .domain([0, d3.max(marginPct)])
        .nice()
        .range([height, 0]);

    // Grid
    svg.append('g')
        .attr('class', 'grid')
        .attr('opacity', 0.1)
        .call(d3.axisLeft(yRevenue).tickSize(-width).tickFormat(''));

    // Revenue line
    const revenueLine = d3.line()
        .x((d, i) => x(months[i]) + x.bandwidth() / 2)
        .y(d => yRevenue(d));

    svg.append('path')
        .datum(revenue)
        .attr('d', revenueLine)
        .attr('stroke', BLUE)
        .attr('stroke-width', 3)
        .attr('fill', 'none');

    // Revenue dots
    svg.selectAll('.dot-revenue')
        .data(revenue).enter().append('circle')
        .attr('cx', (d, i) => x(months[i]) + x.bandwidth() / 2)
        .attr('cy', d => yRevenue(d))
        .attr('r', 5)
        .attr('fill', 'white')
        .attr('stroke', BLUE)
        .attr('stroke-width', 3)
        .style('cursor', 'pointer')
        .on('mouseover', function(event, d) {
            const i = revenue.indexOf(d);
            d3.select(this).attr('r', 7);
            tooltip.style('opacity', 1)
                .html(`
                    <div><span class="tooltip-label">Month:</span><span class="tooltip-value">${monthLabels[i]}</span></div>
                    <div><span class="tooltip-label">Revenue:</span><span class="tooltip-value">$${d.toLocaleString()}</span></div>
                    <div><span class="tooltip-label">Margin:</span><span class="tooltip-value">${marginPct[i]}%</span></div>
                `)
                .style('left', (event.pageX + 12) + 'px')
                .style('top',  (event.pageY - 12) + 'px');
        })
        .on('mouseout', function() {
            d3.select(this).attr('r', 5);
            tooltip.style('opacity', 0);
        });

    // Margin line (dashed)
    const marginLine = d3.line()
        .x((d, i) => x(months[i]) + x.bandwidth() / 2)
        .y(d => yMargin(d));

    svg.append('path')
        .datum(marginPct)
        .attr('d', marginLine)
        .attr('stroke', AMBER)
        .attr('stroke-width', 3)
        .attr('fill', 'none')
        .attr('stroke-dasharray', '5,5');

    // Margin dots
    svg.selectAll('.dot-margin')
        .data(marginPct).enter().append('circle')
        .attr('cx', (d, i) => x(months[i]) + x.bandwidth() / 2)
        .attr('cy', d => yMargin(d))
        .attr('r', 5)
        .attr('fill', 'white')
        .attr('stroke', AMBER)
        .attr('stroke-width', 3)
        .on('mouseover', function(event, d) {
            const i = marginPct.indexOf(d);
            d3.select(this).attr('r', 7);
            tooltip.style('opacity', 1)
                .html(`
                    <div><span class="tooltip-label">Month:</span><span class="tooltip-value">${monthLabels[i]}</span></div>
                    <div><span class="tooltip-label">Revenue:</span><span class="tooltip-value">$${revenue[i].toLocaleString()}</span></div>
                    <div><span class="tooltip-label">Margin:</span><span class="tooltip-value">${d}%</span></div>
                `)
                .style('left', (event.pageX + 12) + 'px')
                .style('top',  (event.pageY - 12) + 'px');
        })
        .on('mouseout', function() {
            d3.select(this).attr('r', 5);
            tooltip.style('opacity', 0);
        });

    // X axis
    svg.append('g')
        .attr('class', 'axis')
        .attr('transform', `translate(0,${height})`)
        .call(d3.axisBottom(x).tickFormat((d, i) => monthLabels[i]));

    // Left Y axis — Revenue
    svg.append('g')
        .attr('class', 'axis')
        .call(d3.axisLeft(yRevenue).ticks(5).tickFormat(d => '$' + d3.format('.2s')(d)));

    svg.append('text')
        .attr('transform', 'rotate(-90)')
        .attr('y', -60).attr('x', -height / 2)
        .attr('text-anchor', 'middle')
        .attr('fill', BLUE).attr('font-size', '12px').attr('font-weight', '600')
        .text('Revenue');

    // Right Y axis — Margin %
    svg.append('g')
        .attr('class', 'axis')
        .attr('transform', `translate(${width}, 0)`)
        .call(d3.axisRight(yMargin).ticks(5).tickFormat(d => d.toFixed(0) + '%'));

    svg.append('text')
        .attr('transform', 'rotate(-90)')
        .attr('y', width + 60).attr('x', -height / 2)
        .attr('text-anchor', 'middle')
        .attr('fill', AMBER).attr('font-size', '12px').attr('font-weight', '600')
        .text('Margin %');
})();


// ═══════════════════════════════════════════════════════════════════════════════
// 2. ApexCharts
// ═══════════════════════════════════════════════════════════════════════════════
(function renderApexChart() {
    const options = {
        chart: {
            type: 'line',
            height: 300,
            fontFamily: 'Inter, sans-serif',
            toolbar: { show: true, tools: { download: true, zoom: true, pan: true, reset: true } },
            animations: { enabled: true, easing: 'easeinout', speed: 600 }
        },
        series: [
            { name: 'Revenue', type: 'line', data: revenue },
            { name: 'Margin %', type: 'line', data: marginPct }
        ],
        colors: [BLUE, AMBER],
        stroke: {
            width: [3, 3],
            dashArray: [0, 5],
            curve: 'smooth'
        },
        markers: {
            size: [5, 5],
            strokeWidth: 3,
            strokeColors: [BLUE, AMBER],
            fillOpacity: 1,
            colors: ['#fff', '#fff'],
            hover: { size: 7 }
        },
        xaxis: {
            categories: monthLabels,
            labels: { style: { colors: '#64748b', fontSize: '11px', fontWeight: 500 } },
            axisBorder: { color: '#cbd5e1' },
            axisTicks: { color: '#cbd5e1' }
        },
        yaxis: [
            {
                title: { text: 'Revenue', style: { color: BLUE, fontSize: '12px', fontWeight: 600 } },
                labels: {
                    style: { colors: '#64748b', fontSize: '11px' },
                    formatter: v => '$' + (v >= 1000 ? (v / 1000).toFixed(1) + 'k' : v)
                }
            },
            {
                opposite: true,
                title: { text: 'Margin %', style: { color: AMBER, fontSize: '12px', fontWeight: 600 } },
                labels: {
                    style: { colors: '#64748b', fontSize: '11px' },
                    formatter: v => v.toFixed(0) + '%'
                },
                min: 0
            }
        ],
        grid: {
            borderColor: '#e2e8f0',
            strokeDashArray: 0,
            xaxis: { lines: { show: false } },
            yaxis: { lines: { show: true } }
        },
        tooltip: {
            shared: true,
            intersect: false,
            theme: 'dark',
            style: { fontSize: '12px' },
            y: {
                formatter: function(val, { seriesIndex }) {
                    return seriesIndex === 0 ? '$' + val.toLocaleString() : val.toFixed(1) + '%';
                }
            }
        },
        legend: {
            position: 'top',
            horizontalAlign: 'right',
            fontSize: '12px',
            fontWeight: 500,
            markers: { radius: 12 }
        }
    };

    new ApexCharts(document.getElementById('apexChart'), options).render();
})();


// ═══════════════════════════════════════════════════════════════════════════════
// 3. Chart.js
// ═══════════════════════════════════════════════════════════════════════════════
(function renderChartJS() {
    const ctx = document.getElementById('chartjsChart').getContext('2d');

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: monthLabels,
            datasets: [
                {
                    label: 'Revenue',
                    data: revenue,
                    borderColor: BLUE,
                    backgroundColor: BLUE + '20',
                    borderWidth: 3,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: BLUE,
                    pointBorderWidth: 3,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    tension: 0.3,
                    fill: false,
                    yAxisID: 'yRevenue'
                },
                {
                    label: 'Margin %',
                    data: marginPct,
                    borderColor: AMBER,
                    backgroundColor: AMBER + '20',
                    borderWidth: 3,
                    borderDash: [5, 5],
                    pointBackgroundColor: '#fff',
                    pointBorderColor: AMBER,
                    pointBorderWidth: 3,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    tension: 0.3,
                    fill: false,
                    yAxisID: 'yMargin'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: {
                    position: 'top',
                    align: 'end',
                    labels: { usePointStyle: true, pointStyle: 'circle', font: { size: 12, weight: 500, family: 'Inter' } }
                },
                tooltip: {
                    backgroundColor: 'rgba(15, 23, 42, 0.95)',
                    titleFont: { size: 12, family: 'Inter' },
                    bodyFont: { size: 12, family: 'Inter' },
                    cornerRadius: 8,
                    padding: 12,
                    callbacks: {
                        label: function(ctx) {
                            if (ctx.dataset.yAxisID === 'yRevenue') {
                                return 'Revenue: $' + ctx.parsed.y.toLocaleString();
                            }
                            return 'Margin: ' + ctx.parsed.y.toFixed(1) + '%';
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: { display: false },
                    ticks: { color: '#64748b', font: { size: 11, weight: 500, family: 'Inter' } },
                    border: { color: '#cbd5e1' }
                },
                yRevenue: {
                    type: 'linear',
                    position: 'left',
                    title: { display: true, text: 'Revenue', color: BLUE, font: { size: 12, weight: 600, family: 'Inter' } },
                    ticks: {
                        color: '#64748b',
                        font: { size: 11, family: 'Inter' },
                        callback: v => '$' + (v >= 1000 ? (v / 1000).toFixed(1) + 'k' : v)
                    },
                    grid: { color: '#e2e8f0' },
                    border: { color: '#cbd5e1' }
                },
                yMargin: {
                    type: 'linear',
                    position: 'right',
                    title: { display: true, text: 'Margin %', color: AMBER, font: { size: 12, weight: 600, family: 'Inter' } },
                    ticks: {
                        color: '#64748b',
                        font: { size: 11, family: 'Inter' },
                        callback: v => v.toFixed(0) + '%'
                    },
                    grid: { drawOnChartArea: false },
                    border: { color: '#cbd5e1' },
                    min: 0
                }
            }
        }
    });
})();


// ═══════════════════════════════════════════════════════════════════════════════
// 4. ECharts
// ═══════════════════════════════════════════════════════════════════════════════
(function renderECharts() {
    const chart = echarts.init(document.getElementById('echartsChart'), null, { renderer: 'svg' });

    const option = {
        tooltip: {
            trigger: 'axis',
            backgroundColor: 'rgba(15, 23, 42, 0.95)',
            borderColor: 'transparent',
            textStyle: { color: '#fff', fontSize: 12, fontFamily: 'Inter' },
            axisPointer: { type: 'cross', crossStyle: { color: '#94a3b8' } },
            formatter: function(params) {
                let html = '<div style="font-weight:600;margin-bottom:4px">' + params[0].name + '</div>';
                params.forEach(p => {
                    const dot = '<span style="display:inline-block;width:8px;height:8px;border-radius:50%;background:' + p.color + ';margin-right:6px"></span>';
                    const val = p.seriesName === 'Revenue'
                        ? '$' + p.value.toLocaleString()
                        : p.value.toFixed(1) + '%';
                    html += '<div>' + dot + p.seriesName + ': <strong>' + val + '</strong></div>';
                });
                return html;
            }
        },
        legend: {
            top: 0,
            right: 0,
            textStyle: { fontSize: 12, fontFamily: 'Inter', fontWeight: 500 },
            icon: 'circle',
            itemWidth: 10,
            itemHeight: 10
        },
        grid: {
            left: 80,
            right: 80,
            top: 40,
            bottom: 40
        },
        xAxis: {
            type: 'category',
            data: monthLabels,
            axisLine: { lineStyle: { color: '#cbd5e1' } },
            axisTick: { lineStyle: { color: '#cbd5e1' } },
            axisLabel: { color: '#64748b', fontSize: 11, fontWeight: 500, fontFamily: 'Inter' }
        },
        yAxis: [
            {
                type: 'value',
                name: 'Revenue',
                nameTextStyle: { color: BLUE, fontSize: 12, fontWeight: 600, fontFamily: 'Inter' },
                axisLabel: {
                    color: '#64748b', fontSize: 11, fontFamily: 'Inter',
                    formatter: v => '$' + (v >= 1000 ? (v / 1000).toFixed(1) + 'k' : v)
                },
                splitLine: { lineStyle: { color: '#e2e8f0' } },
                axisLine: { show: true, lineStyle: { color: '#cbd5e1' } }
            },
            {
                type: 'value',
                name: 'Margin %',
                nameTextStyle: { color: AMBER, fontSize: 12, fontWeight: 600, fontFamily: 'Inter' },
                axisLabel: {
                    color: '#64748b', fontSize: 11, fontFamily: 'Inter',
                    formatter: v => v.toFixed(0) + '%'
                },
                splitLine: { show: false },
                axisLine: { show: true, lineStyle: { color: '#cbd5e1' } },
                min: 0
            }
        ],
        series: [
            {
                name: 'Revenue',
                type: 'line',
                yAxisIndex: 0,
                data: revenue,
                smooth: true,
                lineStyle: { width: 3, color: BLUE },
                itemStyle: { color: BLUE, borderWidth: 3, borderColor: BLUE },
                symbol: 'circle',
                symbolSize: 10,
                emphasis: { symbolSize: 14 }
            },
            {
                name: 'Margin %',
                type: 'line',
                yAxisIndex: 1,
                data: marginPct,
                smooth: true,
                lineStyle: { width: 3, color: AMBER, type: 'dashed' },
                itemStyle: { color: AMBER, borderWidth: 3, borderColor: AMBER },
                symbol: 'circle',
                symbolSize: 10,
                emphasis: { symbolSize: 14 }
            }
        ],
        animationDuration: 600,
        animationEasing: 'cubicInOut'
    };

    chart.setOption(option);

    // Auto-resize
    window.addEventListener('resize', () => chart.resize());
})();

// Resize D3 note: in production we'd need a ResizeObserver — omitted here for simplicity.
</script>

</body>
</html>
